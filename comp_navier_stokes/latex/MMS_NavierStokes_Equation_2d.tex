\documentclass[10pt]{article}
\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
\usepackage{geometry}
\geometry{ top=3cm, bottom=2.5cm, left=2.5cm, right=2.5cm}
\usepackage[authoryear]{natbib}
\usepackage{pdflscape}
%\geometry{papersize={216mm,330mm}, top=3cm, bottom=2.5cm, left=4cm,  right=2cm}

\newcommand{\D}{\partial}
\newcommand{\Diff}[2] {\dfrac{\partial( #1)}{\partial #2}}
\newcommand{\diff}[2] {\dfrac{\partial #1}{\partial #2}}
%opening





\title{Manufactured Solution for 2D Navier-Stokes equation using Maple\footnote{Work based on \citet*{Roy2002}.}}
\author{Kemelli C. Estacio-Hiroms}

\begin{document}

\begin{landscape}

\maketitle

\begin{abstract}
This document describes the application of the Method of Manufactured Solutions (MMS) in order to verify codes for the numerical solutions of the 2D Navier-Stokes equations. \citet{Roy2002}  present the 2D Navier-Stokes equations together with the analytical solution for density, velocity and pressure, but does not present the its respective source terms, obtained through the application of the MMS. Such terms are presented in this document.
\end{abstract}





\section{2D Navier-Stokes Equations}
The 2D Navier-Stokes equations in conservation form are:
\begin{equation}
 \label{eq:ns2d_01}
\Diff{\rho}{t} + \Diff{\rho u}{x}+\Diff{\rho v}{y} = 0
\end{equation}


\begin{equation}
 \label{eq:ns2d_02}
\Diff{\rho u}{t} + \Diff{\rho u^2 + p - \tau_{xx}}{x}+\Diff{\rho uv-\tau_{xy}}{y} = 0
\end{equation}


\begin{equation}
 \label{eq:ns2d_03}
\Diff{\rho v}{t} + \Diff{\rho vu - \tau_{yx}}{x}+\Diff{\rho v^2+p-\tau_{yy}}{y} = 0
\end{equation}


\begin{equation}
 \label{eq:ns2d_04}
\Diff{\rho e_t}{t} + \Diff{\rho ue_t +pu -u \tau_{xx}- v\tau_{xy} +q_x}{x}+\Diff{\rho ve_t +pv- u \tau_{yx} -v \tau_{yy} + q_y}{y} = 0
\end{equation}
%
where the Equation (\ref{eq:ns2d_01}) is the unsteady term (mass conservation), Equations (\ref{eq:ns2d_02}) and (\ref{eq:ns2d_03}) are the nonlinear convection term in the $x$ and $y$ direction (momentum), and Equation (\ref{eq:ns2d_04}) is the energy. Notice that Equations~(\ref{eq:ns2d_02})--(\ref{eq:ns2d_04}) include viscous effects.

For a calorically perfect gas, the Navier-Stokes equations are closed with two auxiliary relations for energy:
\begin{equation}
 \label{eq:ns2d_05}
e=\dfrac{1}{\gamma -1}RT  \quad \mbox{and} \quad e_t= e+\dfrac{u^2+v^2}{2},
\end{equation}
where $\gamma$ is the ratio of specific heats, and with the ideal gas equation of state:
\begin{equation}
 \label{eq:ns2d_07}
p=\rho RT.
\end{equation}

The shear stress tensor is:
\begin{equation}
 \begin{array}{lll}
  \tau_{xx}= \frac{2}{3}  \mu \left( 2 \diff{u}{x} - \diff{v}{y}\right), &
   \tau_{xy}= \mu \left( \diff{u}{y} + \diff{v}{x}\right), \\
 \tau_{yy}= \frac{2}{3}  \mu \left( 2 \diff{v}{y} - \diff{u}{x}\right), &
 \tau_{yx}= \tau_{xy},
 \end{array}
\end{equation}
where $\mu$ is the absolute viscosity. The heat flux vector is given by:
\begin{equation}
 %\begin{split}
 % q_x &= - k \diff{T}{x}\\
%q_y &= - k \diff{T}{y}
% \end{split}
 q_x = - k \diff{T}{x} \quad \mbox{and}\quad q_y = - k \diff{T}{y},
 \end{equation}
where $k$ is the thermal conductivity, which can be determined by choosing the Prandtl number:
$$k= \dfrac{\gamma R \mu}{ (\gamma-1) Pr}.$$



 

\section{Manufactured Solution}

\citet{Roy2002} introduce the general form of the primitive solution variables to be  a function of sines and cosines:
\begin{equation}
 \label{eq:manufactured01}
  \phi (x,y) = \phi_0+ \phi_x f_s(\frac{a_{\phi x} \pi x}{L}) +  \phi_y f_s(\frac{a_{\phi y} \pi y}{L}),
\end{equation}
where $\phi=\rho,u,v$ or $p$, and $f_s(\cdot)$ functions denote either sine or cosine function. Note that in this case, $\phi_x$ and $\phi_y$ are constants  and the subscripts do not denote differentiation.

Therefore, the manufactured analytical solution for each one of the variables in Navier-Stokes equations are:
\begin{equation}
\begin{split}
\label{eq:manufactured02}
\rho\left(x,y\right) &=  \rho_{0}+ \rho_{x} \sin\left(\frac{a_{ \rho x} \pi x}{L}\right)+ \rho_{y} \cos\left(\frac{a_{ \rho y} \pi y}{L}\right),\\
u\left(x,y\right) &= u_{0}+u_{x} \sin\left(\frac{a_{u x} \pi x}{L}\right)+u_{y} \cos\left(\frac{a_{u y} \pi y}{L}\right),\\
v\left(x,y\right) &= v_{0}+v_{x} \cos\left(\frac{a_{v x} \pi x}{L}\right)+v_{y} \sin\left(\frac{a_{v y} \pi y}{L}\right),\\
p\left(x,y\right) &= p_{0}+p_{x} \cos\left(\frac{a_{p x} \pi x}{L}\right)+p_{y} \sin\left(\frac{a_{p y} \pi y}{L}\right).\\
\end{split}
\end{equation}



The method of manufactured solutions applied to Navier-Stokes equations consists in modifying Equations~(\ref{eq:ns2d_01}) -- (\ref{eq:ns2d_04}) by adding a source term to the right-hand side of each equation:
\begin{equation}
\begin{split}
\label{eq:ns2d_mod}
& \Diff{\rho}{t} + \Diff{\rho u}{x}+\Diff{\rho v}{y} = Q_\rho\\
& \Diff{\rho u}{t} + \Diff{\rho u^2 + p - \tau_{xx}}{x}+\Diff{\rho uv-\tau_{xy}}{y} = Q_u\\
& \Diff{\rho v}{t} + \Diff{\rho vu - \tau_{yx}}{x}+\Diff{\rho v^2+p-\tau_{yy}}{y} = Q_v\\
& \Diff{\rho e_t}{t} + \Diff{\rho ue_t +pu -u \tau_{xx}- v\tau_{xy} +q_x}{x}+\Diff{\rho ve_t +pv- u \tau_{yx} -v \tau_{yy} + q_y}{y} = Q_{e_t}
\end{split}
\end{equation}
so the modified set of equations has known, analytical solution.

In the case of $Q_\rho$, $Q_u$, $Q_v$ and $Q_{e_t}$ are conveniently obtained by analytical differentiation of Equation ({\ref{eq:manufactured02}}) using Equations~ (\ref{eq:ns2d_01}) -- (\ref{eq:ns2d_04}) as differential operators, the solution of Equation (\ref{eq:ns2d_mod}) is  Equation (\ref{eq:manufactured02}).

Source terms $Q_\rho$, $Q_u$, $Q_v$ and $Q_{e_t}$ are obtained by symbolic manipulations of equations above using Maple and are presented in the following sections.

\section{Navier-Stokes mass conservation equation}

The mass conservation equation written as an operator is:
\begin{equation}
 \label{eq:ns2d_11}
L= \Diff{\rho}{t} + \Diff{\rho u}{x}+\Diff{\rho v}{y} 
\end{equation}

Analytically differentiating Equation (\ref{eq:manufactured02}) for $\rho$, $u$ and $v$ using operator $L$ defined above gives  the source term $Q_{\rho}$:

\begin{equation}
\begin{split}
Q_{\rho} &= \dfrac{a_{\rho x}  \pi \rho_{x} }{L} \cos\left(\dfrac{ a_{\rho   x}\pi x}{L}\right)\left[u_x  \sin\left( \dfrac{a_{ux} \pi x}{L} \right) +u_y  \cos \left( \dfrac{a_{uy} \pi y}{L} \right) +u_ 0\right] \\
%
&-\dfrac{a_{\rho y} \pi  \rho _{y} }{L}\sin\left(\dfrac{a_{\rho   y}\pi y }{L}\right)\left[v_x  \cos \left( \dfrac{a_{vx} \pi x}{L} \right) +v_y  \sin\left( \dfrac{a_{vy} \pi y}{L} \right) +v_ 0\right]\\
%
&+\dfrac{ a_{u  x} \pi  u_{x} }{L}\cos\left(\dfrac{ a_{u  x}\pi x}{L}\right)\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right] \\
%
&+\dfrac{a_{v  y} \pi  v_{y} }{L}\cos\left(\dfrac{ a_{v  y}\pi y}{L}\right)\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]
\end{split}
\end{equation}


\section{Navier-Stokes momentum equation}

For the generation of the analytical source term $Q_u$ for the $x$ momentum equation, Equation  (\ref{eq:ns2d_02}) is written as an  operator $L$:
\begin{equation}
 \label{eq:ns2d_12}
L=\Diff{\rho u}{t} + \Diff{\rho u^2 + p - \tau_{xx}}{x}+\Diff{\rho uv-\tau_{xy}}{y}
\end{equation}
which, when operated in Equation (\ref{eq:manufactured02}), provides source term $Q_{u}$:


\begin{equation}
 \begin{split}
Q_u = &- \dfrac{a_{px}  \pi p_x   }{L}\sin\left( \dfrac{a_{px} \pi x}{L} \right)  \\
&+  \dfrac{ a_{\rho x} \pi   \rho_x   }{L} \cos \left( \dfrac{a_{\rho x} \pi x }{L} \right)  \left[u_x  \sin\left( \dfrac{a_{ux} \pi x}{L} \right) +u_y  \cos \left( \dfrac{a_{uy} \pi y}{L} \right) +u_ 0\right]^2  \\
& -  \dfrac{ a_{\rho y} \pi   \rho_y   }{L} \sin\left( \dfrac{a_{\rho y} \pi y }{L} \right)   \left[v_x  \cos \left( \dfrac{a_{vx} \pi x}{L} \right) +v_y  \sin\left( \dfrac{a_{vy} \pi y}{L} \right) +v_ 0\right] \left[u_x  \sin\left( \dfrac{a_{ux} \pi x}{L} \right) +u_y  \cos \left( \dfrac{a_{uy} \pi y}{L} \right) +u_ 0\right] \\
& +\dfrac{2 a_{ux} \pi   u_x }{L} \cos \left( \dfrac{a_{ux} \pi x}{L} \right)  \left[u_x  \sin\left( \dfrac{a_{ux} \pi x}{L} \right) +u_y  \cos \left( \dfrac{a_{uy} \pi y}{L} \right) +u_ 0\right]\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right] \\
& -\dfrac{\pi a_{uy} u_y }{L}  \sin\left( \dfrac{a_{uy} \pi y}{L} \right) \left[v_x  \cos \left( \dfrac{a_{vx} \pi x}{L} \right) +v_y  \sin\left( \dfrac{a_{vy} \pi y}{L} \right) +v_ 0\right]\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]  \\
& + \dfrac{\pi a_{vy}  v_y }{L}  \cos \left( \dfrac{a_{vy} \pi y}{L} \right) \left[u_x  \sin\left( \dfrac{a_{ux} \pi x}{L} \right) +u_y  \cos \left( \dfrac{a_{uy} \pi y}{L} \right) +u_ 0\right]\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]\\
&+ \dfrac{4  a_{ux}^2 \pi^2 \mu  u_x }{3 L^2}\sin\left( \dfrac{a_{ux} \pi x}{L} \right)\quad  + \quad \dfrac{a_{uy}^2  \pi^2 \mu u_y }{L^2}  \cos \left( \dfrac{a_{uy} \pi y}{L} \right)
 \end{split}
\end{equation}


Analogously, for the generation of the analytical source term $Q_v$ for the $y$ momentum equation, Equation~(\ref{eq:ns2d_03}) is written as an  operator $L$:
\begin{equation}
  \label{eq:ns2d_13}
  L = \Diff{\rho v}{t} + \Diff{\rho vu - \tau_{yx}}{x}+\Diff{\rho v^2+p-\tau_{yy}}{y}
\end{equation}
and then applied to Equation  (\ref{eq:manufactured02}). It yields:
\begin{equation}
\begin{split} 
Q_v &=  \dfrac{ a_{py}  \pi   p_y }{L}\cos \left( \dfrac{a_{py} \pi y}{L} \right)  \\
&+ \dfrac{ \pi  a_{\rho x} \rho_x  }{L} \cos \left( \dfrac{ a_{\rho x}\pi x}{L} \right) \left[v_x  \cos \left( \dfrac{a_{vx} \pi x}{L} \right) +v_y  \sin\left( \dfrac{a_{vy} \pi y}{L} \right) +v_ 0\right] \left[u_x  \sin\left( \dfrac{a_{ux} \pi x}{L} \right) +u_y  \cos \left( \dfrac{a_{uy} \pi y}{L} \right) +u_ 0\right]  \\
& -  \dfrac{a_{\rho y}\pi\rho_y   }{L}  \sin\left( \dfrac{a_{\rho y}\pi y }{L} \right) \left[v_x  \cos \left( \dfrac{a_{vx} \pi x}{L} \right) +v_y  \sin\left( \dfrac{a_{vy} \pi y}{L} \right) +v_ 0\right]^2  \\
& + \dfrac{a_{ux} \pi   u_x }{L} \cos \left( \dfrac{a_{ux} \pi x}{L} \right)  \left[v_x  \cos \left( \dfrac{a_{vx} \pi x}{L} \right) +v_y  \sin\left( \dfrac{a_{vy} \pi y}{L} \right) +v_ 0\right]\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]  \\
& -\dfrac{ a_{vx} \pi v_x }{L} \sin\left( \dfrac{a_{vx} \pi x}{L} \right) \left[u_x  \sin\left( \dfrac{a_{ux} \pi x}{L} \right) +u_y  \cos \left( \dfrac{a_{uy} \pi y}{L} \right) +u_ 0\right]\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]  \\
& +\dfrac{2  a_{vy} \pi v_y  }{L} \cos \left( \dfrac{a_{vy} \pi y}{L} \right)\left[v_x  \cos \left( \dfrac{a_{vx} \pi x}{L} \right) +v_y  \sin\left( \dfrac{a_{vy} \pi y}{L} \right) +v_ 0\right]\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]\\
& + \dfrac{a_{vx}^2 \pi^2 \mu   v_x  }{L^2}\cos \left( \dfrac{a_{vx} \pi x}{L} \right)  +  \dfrac{4 a_{vy}^2  \pi^2 \mu  v_y  }{3L^2}\sin\left( \dfrac{a_{vy} \pi y}{L} \right)
 \end{split}
\end{equation}

\section{Navier-Stokes energy equation}


The last component of Navier-Stokes equations is written as an operator:
\begin{equation}
 \label{eq:ns2d_14}
L=\Diff{\rho e_t}{t} + \Diff{\rho ue_t +pu -u \tau_{xx}- v\tau_{xy} +q_x}{x}+\Diff{\rho ve_t +pv- u \tau_{yx} -v \tau_{yy} + q_y}{y}.
\end{equation}


Source term $Q_e$ is obtained by operating $L$ on Equation  (\ref{eq:manufactured02}) together with the use of the  auxiliary relations~(\ref{eq:ns2d_05})--(\ref{eq:ns2d_07}) for energy. It is presented in Equation (\ref{eq:source_e}).


\begin{equation}\label{eq:source_e}
\begin{split}
\displaystyle
Q_{e_t}=
& - \dfrac{a_{px} \pi p_x}{L}\dfrac{\gamma }{\gamma  - 1} \sin\left(\dfrac{a_{px} \pi x}{L}\right)\left[u_x \sin\left(\dfrac{a_{ux} \pi x}{L}\right) + u_y \cos\left(\dfrac{a_{uy} \pi y}{L}\right) + u_0\right]\\
& + \dfrac{a_{py} \pi p_y}{L}\dfrac{\gamma }{\gamma  - 1} \cos\left(\dfrac{a_{py} \pi y}{L}\right)\left[v_x \cos\left(\dfrac{a_{vx} \pi x}{L}\right) + v_y \sin\left(\dfrac{a_{vy} \pi y}{L}\right) + v_0\right]\\
& + \dfrac{a_{\rho x} \pi \rho_x}{2L} \cos\left(\dfrac{a_{\rho x} \pi x}{L}\right)\left[u_x \sin\left(\dfrac{a_{ux} \pi x}{L}\right) + u_y \cos\left(\dfrac{a_{uy} \pi y}{L}\right) + u_0\right]\left[\left[u_x \sin\left(\dfrac{a_{ux} \pi x}{L}\right) + u_y \cos\left(\dfrac{a_{uy} \pi y}{L}\right) + u_0\right]^2 + \left[v_x \cos\left(\dfrac{a_{vx} \pi x}{L}\right) + v_y \sin\left(\dfrac{a_{vy} \pi y}{L}\right) + v_0\right]^2\right]\\
& - \dfrac{a_{\rho y} \pi \rho_y}{2L} \sin\left(\dfrac{a_{\rho y} \pi y}{L}\right)\left[v_x \cos\left(\dfrac{a_{vx} \pi x}{L}\right) + v_y \sin\left(\dfrac{a_{vy} \pi y}{L}\right) + v_0\right]\left[\left[u_x \sin\left(\dfrac{a_{ux} \pi x}{L}\right) + u_y \cos\left(\dfrac{a_{uy} \pi y}{L}\right) + u_0\right]^2 + \left[v_x \cos\left(\dfrac{a_{vx} \pi x}{L}\right) + v_y \sin\left(\dfrac{a_{vy} \pi y}{L}\right) + v_0\right]^2\right]\\
& + \dfrac{a_{ux} \pi u_x}{2L} \cos\left(\dfrac{a_{ux} \pi x}{L}\right)\left\{\left[p_x \cos\left(\dfrac{a_{px} \pi x}{L}\right) + p_y \sin\left(\dfrac{a_{py} \pi y}{L}\right) + p_0\right]\dfrac{2\gamma }{\gamma  - 1} + \right.\\
&\quad\quad + \left.\left[3\left[u_x \sin\left(\dfrac{a_{ux} \pi x}{L}\right) + u_y \cos\left(\dfrac{a_{uy} \pi y}{L}\right) + u_0\right]^2 + \left[v_x \cos\left(\dfrac{a_{vx} \pi x}{L}\right) + v_y \sin\left(\dfrac{a_{vy} \pi y}{L}\right) + v_0\right]^2\right]\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]\right\}\\
& - \dfrac{a_{uy} \pi u_y}{L} \sin\left(\dfrac{a_{uy} \pi y}{L}\right)\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]\left[u_x \sin\left(\dfrac{a_{ux} \pi x}{L}\right) + u_y \cos\left(\dfrac{a_{uy} \pi y}{L}\right) + u_0\right]\left[v_x \cos\left(\dfrac{a_{vx} \pi x}{L}\right) + v_y \sin\left(\dfrac{a_{vy} \pi y}{L}\right) + v_0\right]\\
& - \dfrac{a_{vx} \pi v_x}{L} \sin\left(\dfrac{a_{vx} \pi x}{L}\right)\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]\left[u_x \sin\left(\dfrac{a_{ux} \pi x}{L}\right) + u_y \cos\left(\dfrac{a_{uy} \pi y}{L}\right) + u_0\right]\left[v_x \cos\left(\dfrac{a_{vx} \pi x}{L}\right) + v_y \sin\left(\dfrac{a_{vy} \pi y}{L}\right) + v_0\right]\\
& + \dfrac{a_{vy} \pi v_y}{2L} \cos\left(\dfrac{a_{vy} \pi y}{L}\right)\left\{\left[p_x \cos\left(\dfrac{a_{px} \pi x}{L}\right) + p_y \sin\left(\dfrac{a_{py} \pi y}{L}\right) + p_0\right]\dfrac{2\gamma }{\gamma  - 1}\right.\\
&\quad\quad\left. + \left[\left[u_x \sin\left(\dfrac{a_{ux} \pi x}{L}\right) + u_y \cos\left(\dfrac{a_{uy} \pi y}{L}\right) + u_0\right]^2 + 3\left[v_x \cos\left(\dfrac{a_{vx} \pi x}{L}\right) + v_y \sin\left(\dfrac{a_{vy} \pi y}{L}\right) + v_0\right]^2\right]\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]\right\}\\
&+ \cdots
\end{split}
\end{equation}

\begin{equation*}\label{eq:source_e2}
\begin{split}
\displaystyle
%%
& + \dfrac{a_{px}^2 \pi ^2k\,p_x \cos\left(\dfrac{a_{px} \pi x}{L}\right)}{\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]L^2R}\\
%%
& + \dfrac{a_{py}^2 \pi ^2k\,p_y \sin\left(\dfrac{a_{py} \pi y}{L}\right)}{\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]L^2R}\\
%
& - \dfrac{2a_{\rho x}^2 \pi ^2 k\,\rho_x^2}{L^2R} \cos^2\left(\dfrac{a_{\rho x} \pi x}{L}\right)\dfrac{\left[p_x \cos\left(\dfrac{a_{px} \pi x}{L}\right) + p_y \sin\left(\dfrac{a_{py} \pi y}{L}\right) + p_0\right]}{\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]^3}\quad - \quad\dfrac{a_{\rho x}^2 \pi ^2 k \rho_x  }{L^2R} \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right)\dfrac{\left[p_x \cos\left(\dfrac{a_{px} \pi x}{L}\right) + p_y \sin\left(\dfrac{a_{py} \pi y}{L}\right) + p_0\right]}{\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]^2}\\
%
& - \dfrac{2a_{\rho y}^2 \pi ^2 k\,\rho_y^2}{L^2R} \sin^2\left(\dfrac{a_{\rho y} \pi y}{L}\right)\dfrac{\left[p_x \cos\left(\dfrac{a_{px} \pi x}{L}\right) + p_y \sin\left(\dfrac{a_{py} \pi y}{L}\right) + p_0\right]}{\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]^3}\quad - \quad\dfrac{a_{\rho y}^2 \pi^2 k \rho_y  }{L^2R} \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right)\dfrac{\left[p_x \cos\left(\dfrac{a_{px} \pi x}{L}\right) + p_y \sin\left(\dfrac{a_{py} \pi y}{L}\right) + p_0\right]}{\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]^2}\\
&+\dfrac{4a_{ux}^2\pi ^2\mu u_x}{3L^2} \sin\left(\dfrac{a_{ux} \pi x}{L}\right)\left[u_x \sin\left(\dfrac{a_{ux} \pi x}{L}\right) + u_y \cos\left(\dfrac{a_{uy} \pi y}{L}\right) + u_0\right]\quad - \quad\dfrac{4a_{ux}^2 \pi ^2\mu u_x^2}{3L^2} \cos^2\left(\dfrac{a_{ux} \pi x}{L}\right)\\
& + \dfrac{a_{uy}^2\pi ^2\mu u_y}{L^2} \cos\left(\dfrac{a_{uy} \pi y}{L}\right)\left[u_x \sin\left(\dfrac{a_{ux} \pi x}{L}\right) + u_y \cos\left(\dfrac{a_{uy} \pi y}{L}\right) + u_0\right]\quad - \quad\dfrac{a_{uy}^2\pi ^2\mu u_y^2}{L^2} \sin^2\left(\dfrac{a_{uy} \pi y}{L}\right)\\
& + \dfrac{a_{vx}^2\pi ^2\mu v_x}{L^2} \cos\left(\dfrac{a_{vx} \pi x}{L}\right)\left[v_x \cos\left(\dfrac{a_{vx} \pi x}{L}\right) + v_y \sin\left(\dfrac{a_{vy} \pi y}{L}\right) + v_0\right]\quad - \quad\dfrac{a_{vx}^2\pi ^2\mu v_x^2}{L^2} \sin^2\left(\dfrac{a_{vx} \pi x}{L}\right)\\
& + \dfrac{4 a_{vy}^2\pi ^2\mu v_y}{3L^2} \sin\left(\dfrac{a_{vy} \pi y}{L}\right)\left[v_x \cos\left(\dfrac{a_{vx} \pi x}{L}\right) + v_y \sin\left(\dfrac{a_{vy} \pi y}{L}\right) + v_0\right]\quad - \quad\dfrac{4a_{vy}^2\pi ^2\mu v_y^2}{3L^2} \cos^2\left(\dfrac{a_{vy} \pi y}{L}\right)\\
& - \dfrac{2a_{px}a_{\rho x} \pi ^2k\,p_x\rho_x}{L^2R}\dfrac{ \cos\left(\dfrac{a_{\rho x} \pi x}{L}\right) \sin\left(\dfrac{a_{px} \pi x}{L}\right)}{\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]^2}\\
& - \dfrac{2a_{py}a_{\rho y}\pi ^2k\,p_y\rho_y}{L^2R}\dfrac{ \cos\left(\dfrac{a_{py} \pi y}{L}\right) \sin\left(\dfrac{a_{\rho y} \pi y}{L}\right)}{\left[\rho_x \sin\left(\dfrac{a_{\rho x} \pi x}{L}\right) + \rho_y \cos\left(\dfrac{a_{\rho y} \pi y}{L}\right) + \rho_0\right]^2}\\
& + \dfrac{4a_{ux}a_{vy}\pi ^2\mu u_x v_y}{3L^2} \cos\left(\dfrac{a_{ux} \pi x}{L}\right) \cos\left(\dfrac{a_{vy} \pi y}{L}\right)\\
& - \dfrac{2a_{uy}a_{vx}\pi ^2\mu u_y v_x}{L^2} \sin\left(\dfrac{a_{uy} \pi y}{L}\right) \sin\left(\dfrac{a_{vx} \pi x}{L}\right).
\end{split}
\end{equation*}



%------------------------------------------------

\section{Comments}


Source terms $Q_{\rho}$, $Q_u$ and $Q_v$ have been generated automatically by replacing the analytical expressions (\ref{eq:manufactured02}) into  respective operators, followed by the usage of Maple commands for collecting, sorting and factorizing the terms. Yet,  to achieve the final form of source term $Q_{e_t}$, due to its higher complexity, a slightly different procedure has been applied.  First, $Q_{e_t}$ has manually been split into several subterms, to facilitate and improve the symbolic manipulation; then Maple commands for collecting, sorting and factorizing have been employed. Finally, the resulting source term has been compared to its original form to ensure correctness. As  result, the initially 26--page long expression for $Q_{e_t}$ has been  reduced to Equation~(\ref{eq:source_e}). Please see file {\tt NavierStokes\_equation\_2d\_energy\_Maple.pdf} for the original expression of $Q_{e_t}$.

Files containing  $C$ codes for the source terms have also been generated. They are: \texttt{NavierStokes\_2d\_e\_code.C,} \texttt{NavierStokes\_2d\_rho\_code.C}, \texttt{NavierStokes\_2d\_u\_code.C} and  \texttt{NavierStokes\_2d\_v\_code.C}.

An example of the automatically generated C file from the source term for mass conservation equation is:

\begin{verbatim}
 #include <math.h>

double SourceQ_rho (double x,  double y,  double u_0,  double u_x,  double u_y,  double v_0,  double v_x,  double v_y,
                    double rho_0,  double rho_x,  double rho_y,  double p_0,  double p_x,  double p_y,  double a_px,
                    double a_py,  double a_rhox,   double a_rhoy,  double a_ux,  double a_uy,  double a_vx,  double a_vy,
                    double mu,  double L)
{
  double Q_rho;
  Q_rho = (u_x * sin(a_ux * PI * x / L) +
  u_y * cos(a_uy * PI * y / L) + u_0) * a_rhox * PI * rho_x * cos(a_rhox * PI * x / L) / L
  - (v_x * cos(a_vx * PI * x / L) + v_y * sin(a_vy * PI * y / L) +  v_0) * a_rhoy * PI * rho_y * sin(a_rhoy * PI * y / L) / L
  + (rho_x * sin(a_rhox * PI * x / L) + rho_y * cos(a_rhoy * PI * y / L) + rho_0) * a_ux * PI * u_x * cos(a_ux * PI * x / L) / L
  + (rho_x * sin(a_rhox * PI * x / L) + rho_y * cos(a_rhoy * PI * y / L) + rho_0) * a_vy * PI * v_y * cos(a_vy * PI * y / L) / L;
  return(Q_rho);
}
\end{verbatim}


Finally the gradients of the analytical solutions have also been computed and their respective C codes are presented in \\ \texttt{NavierStokes\_manuf\_solutions\_grad\_and\_code\_2d.C}. Therefore, the gradients of the anylitical solution~ (\ref{eq:manufactured02}):
\begin{equation}
\nabla \rho = \left[ \begin{array}{c}
 \dfrac{  a_{\rho x}  \pi rho_x }{L} \cos\left( \dfrac{ a_{\rho x}  \pi  x }{L}\right) \vspace{5pt}\\ 
 -\dfrac{  a_{\rho y}  \pi rho_y }{L} \sin\left( \dfrac{ a_{\rho y}  \pi  y }{L}\right) 
\end{array} \right],
\qquad
\nabla p = \left[ \begin{array}{c}
- \dfrac{  a_{px}  \pi p_x }{L} \sin\left( \dfrac{ a_{px}  \pi  x }{L}\right) \vspace{5pt}\\
  \dfrac{  a_{py}  \pi p_y }{L} \cos\left( \dfrac{ a_{py}  \pi  y }{L}\right)
\end{array} \right],
\end{equation}
\begin{equation}
\nabla u = \left[ \begin{array}{c}
\dfrac{  a_{ux}  \pi u_x}{L} \cos\left( \dfrac{ a_{ux}  \pi  x }{L}\right)\vspace{5pt} \\
-  \dfrac{  a_{uy}  \pi u_y }{L} \sin\left( \dfrac{ a_{uy}  \pi  y }{L}\right)
\end{array} \right]
\quad \mbox{and} \quad
\nabla v = \left[ \begin{array}{c}
-  \dfrac{  a_{vx}  \pi v_x }{L} \sin\left( \dfrac{ a_{vx}  \pi  x }{L}\right)\vspace{5pt} \\
 \dfrac{  a_{vy}  \pi  v_y }{L} \cos\left( \dfrac{ a_{vy}  \pi  y }{L}\right) 
\end{array} \right]
\end{equation}
are written in C language as:

\begin{verbatim}
grad_rho_an[0] = rho_x * cos(a_rhox * pi * x / L) * a_rhox * pi / L;
grad_rho_an[1] = -rho_y * sin(a_rhoy * pi * y / L) * a_rhoy * pi / L;
grad_p_an[0] = -p_x * sin(a_px * pi * x / L) * a_px * pi / L;
grad_p_an[1] = p_y * cos(a_py * pi * y / L) * a_py * pi / L;
grad_u_an[0] = u_x * cos(a_ux * pi * x / L) * a_ux * pi / L;
grad_u_an[1] = -u_y * sin(a_uy * pi * y / L) * a_uy * pi / L;
grad_v_an[0] = -v_x * sin(a_vx * pi * x / L) * a_vx * pi / L;
grad_v_an[1] = v_y * cos(a_vy * pi * y / L) * a_vy * pi / L;
\end{verbatim}

%------------------------------------------------



%---------------------------------------------------------------------------------------------------------
\bibliographystyle{chicago} 
\bibliography{/home/kemelli/MMS_maple_workplace/heat_equation/MMS_bib}
\end{landscape}
\end{document}
