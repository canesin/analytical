\documentclass[10pt]{article}
\usepackage[utf8x]{inputenc}
\usepackage{amsmath}
\usepackage{geometry}
\geometry{ top=3cm, bottom=2.5cm, left=2.5cm, right=2.5cm}
\usepackage[authoryear]{natbib}
\usepackage{pdflscape}
%\geometry{papersize={216mm,330mm}, top=3cm, bottom=2.5cm, left=4cm,  right=2cm}

\newcommand{\D}{\partial}
\newcommand{\Diff}[2] {\dfrac{\partial( #1)}{\partial #2}}
\newcommand{\diff}[2] {\dfrac{\partial #1}{\partial #2}}

%opening
\title{Manufactured Solution for 2D Burgers equations using Maple\footnote{Work based on \citet*{Salari_Knupp_2000}.}}
\author{Kémelli C. Estacio-Hiroms}

\begin{document}

\maketitle

\begin{abstract}
This document describes the usage of the Method of Manufactured Solutions (MMS) for Code Verification of burgers solvers for two-dimensional, unsteady flows. The manufactured solutions chosen for the flow variables are time-dependent, smooth and have non-trivial derivatives, so they may exercise all the terms of the governing equations without imposing special coordinate systems or particular
boundary conditions. By the application of the MMS, a related set of governing equations is generated. The analytical solutions of the MMS-modified governing equations are, in turn, the manufactured solutions chosen a priori. %  Such equations  have analytical solutions, namely, the same set of manufactured solutions chosen a priori - conveniently but not coincidently.
Thus, the modified set of equations genetared by the MMS may be discretized and solved numerically, convergence studies may be conducted, and the code may be verified.
A choice of analytical solutions for the flow variables of the 2D Burgers equations and their respective source terms are presented in this document.
\end{abstract}


\section{2D Burgers Equations}

Burgers' equation is a useful test case for numerical methods due to its simplicity and predictable dynamics, together with it's non-linearity and multidimensionality. Various kinds of Burgers equation constitutes a good benchmark to modelling traffic flows, shock waves and acoustic transmission, and they are also considered a basic model of nonlinear convective-diffusive phenomena such as those that arise
in Navier–Stokes equations.


The 2D Burgers  equations are:
\begin{equation}
 \label{eq:burgers2d_01}
\diff{ u}{t} + \diff{ u^2 }{x}+\diff{uv}{y}=\nu \left( \diff{^2u}{ x^2}+ \diff{^2u }{y^2}\right),
\end{equation}
and
\begin{equation}
 \label{eq:burgers2d_02}
 \diff{ v}{t}+ \diff{ u v}{x} + \diff{  v^2 }{y}=\nu \left( \diff{^2v}{ x^2}+ \diff{^2v }{y^2}\right),
\end{equation}
%
where $u$ and $v$ are the velocity in the  $x$ and $y$  directions, respectively, and $\nu$ is the viscosity.

\section{Manufactured Solution}
The Method of Manufactured Solutions (MMS) provides a general procedure for  code accuracy verification \citep{Roache2002,Bond2007}. % The basic idea of the procedure is to simply manufacture an exact solution, without being concerned about its physical realism. This approach to constructing test problems includes in the code a general  source term $Q$, and uses it to generate a nontrivial but known solution structure.
%
The MMS constructs a non-trivial but analytical solution for the flow variables; this manufactured
solution usually does not  satisfy the governing equations, since the choice is somewhat arbritary. However, by passing the solution through the governing equations gives the production terms $Q$. A modified set of equations formed by adding these source terms to the right-hand-side of the orignial governing equations is forced to become a model for the constructed solution, i.e., the manufactured solutions chosen \textit{a priori} are the analytical solutions of the MMS-modified equations.

Although the form of the manufactured solution is slightly arbitrary, it should be chosen to be smooth, infinitely differentiable and realizable (solutions should be avoided which have negative densities, pressures, temperatures, etc.)\citep{Salari_Knupp_2000,Roy2004}. Solutions should also be chosen that are sufficiently general so as to exercise all terms in the governing equations. Examples of manufactured solutions and convergence studies for Burgers, Euler and/or Navier--Stokes equations may be found in \citet{Salari_Knupp_2000,Roy2002,Roy2004,Bond2007,Orozco2010}.

\citet{Salari_Knupp_2000} propose the general form of the primitive solution variables to be  a function of sines or cosines:
\begin{equation}
 \label{eq:manufactured01}
  \phi (x,y,t) = \phi_{0} \Big( f_s(x^2+y^2+\omega t) + \varepsilon\Big) ,\\
\end{equation}
where $u$ or $v$, and $f_s(\cdot)$ functions denote either sine or cosine function. Note that $\phi_0$, $\omega$ and $\epsilon$ are constants.

Therefore, a suitable set of time-dependent manufactured analytical solutions for for each one of the variables in burgers equations is:
\begin{equation}
\begin{split}
\label{eq:manufactured02}
u(x,y,t) &= u_{0} \Big( \sin(x^2+y^2+\omega t) + \varepsilon \Big) ,\\
v(x,y,t) &= v_{0} \Big( \cos(x^2+y^2+\omega t) + \varepsilon \Big) ,\\
\end{split}
\end{equation}



The source terms for the 2D Burger equations (\ref{eq:burgers2d_01}) and (\ref{eq:burgers2d_02}) using time-dependent manufactured solutions  for $u$ and $v$, described in Equations (\ref{eq:manufactured02}) are presented in the following sections. The inviscid and the steady state cases are also presented.


\section{Burgers equation}



For the generation of the analytical source term $Q_u$ for the velocity in the $x$-direction, Equation  (\ref{eq:burgers2d_02}) is written as an  operator $L$:
\begin{equation}
 \label{eq:burgers2d_12}
L=\diff{ u}{t} + \diff{ u^2 }{x}+\diff{uv}{y}-\nu \left( \diff{^2u}{ x^2}+ \diff{^2u }{y^2}\right).
\end{equation}
which, when operated in Equation (\ref{eq:manufactured02}), provides source term $Q_{u}$:
\begin{equation}
\begin{split}Q_u &= 2 u_0^2 \, x\,[\sin\big(2(x^2+y^2+\omega t)\big)+2 \varepsilon \cos(x^2+y^2+\omega t)] +\\
&+2 u_0 \,v_0\, y\,[-2 \sin^2(x^2+y^2+\omega t)-\varepsilon \sin(x^2+y^2+\omega t)+\varepsilon \cos(x^2+y^2+\omega t)+1] +\\
&+4u_0 \,\nu\,[( x^2 + y^2 )\sin(x^2+y^2+\omega t)- \cos(x^2+y^2+\omega t)]+\\
&+u_0 \,\omega\, \cos(x^2+y^2+\omega t).
\end{split}
 \end{equation}

Analogously, for the generation of the analytical source term $Q_v$ for the $y$-velocity, Equation~(\ref{eq:burgers2d_03}) is written as an  operator $L$:
\begin{equation}
  \label{eq:burgers2d_13}
  L = \diff{ v}{t}+ \diff{ u v}{x} + \diff{  v^2 }{y}-\nu \left( \diff{^2v}{ x^2}+ \diff{^2v }{y^2}\right).
\end{equation}
and then applied to Equation  (\ref{eq:manufactured02}). It yields:
\begin{equation}
\begin{split}
Q_v =& -2 v_0^2 \,y \,[2 \varepsilon \sin(x^2+y^2+\omega t)+\sin\big(2(x^2+y^2+\omega t)\big)]+\\
&+2 v_0 \,u_0 \,x\,[-2 \sin^2(x^2+y^2+\omega t)-\varepsilon \sin(x^2+y^2+\omega t)+\varepsilon \cos(x^2+y^2+\omega t)+1] +\\
&+4 v_0 \,\nu\,[ ( x^2 + y^2 )\cos(x^2+y^2+\omega t)+ \sin(x^2+y^2+\omega t)] \\
&-v_0\, \omega \,\sin(x^2+y^2+\omega t). \end{split}
\end{equation}

\subsection{Steady Burgers Equation}
%The steady solution to Burgers equation (\ref{eq:burgers2d_01}) and (\ref{eq:burgers2d_02}) is obtained by setting the $\omega$ to zero in the manufactured solution (\ref{eq:manufactured02}). Accordingly, the resulting source terms are:
For the steady Burgers flow:
\begin{equation}
 \label{eq:burgers2d_3}
 \diff{ u^2 }{x}+\diff{uv}{y}=\nu \left( \diff{^2u}{ x^2}+ \diff{^2u }{y^2}\right),
\end{equation}
\begin{equation}
  \label{eq:burgers2d_4}
 \diff{ u v}{x} + \diff{  v^2 }{y}=\nu \left( \diff{^2v}{ x^2}+ \diff{^2v }{y^2}\right),
\end{equation}
%
$\omega$ is set to zero in the manufactured solution (\ref{eq:manufactured02}) and the resulting source terms are:
\begin{equation}
\begin{split}
Q_u&=2 u_0^2 x [\sin\big(2(x^2+y^2)\big)+2 \varepsilon \cos(x^2+y^2)]+\\
&+  2u_0 v_0 y [-2 \sin^2(x^2+y^2)-\varepsilon \sin(x^2+y^2)+\varepsilon \cos(x^2+y^2)+1] +\\
&+ 4 u_0 \nu [ (x^2 +y^2 )\sin(x^2+y^2)-4 \cos(x^2+y^2)],
 \end{split}
\end{equation}
and
\begin{equation}
\begin{split}
Q_v&=-2 v_0^2 y[2 \varepsilon \sin(x^2+y^2)+\sin\big(2(x^2+y^2)\big)] +\\
&+  2 v_0 u_0 x[-2 \sin^2(x^2+y^2)-\varepsilon \sin(x^2+y^2)+\varepsilon \cos(x^2+y^2)+1] +\\
&+  4v_0 \nu[( x^2 + y^2) \cos(x^2+y^2)+4 \sin(x^2+y^2)].
 \end{split}
\end{equation}



\subsection{Inviscid Burgers equation}

The 2D inviscid Burgers  equations are:
\begin{equation}
 \label{eq:burgers2d_05}
\diff{ u}{t} + \diff{ u^2 }{x}+\diff{uv}{y}=0,
\end{equation}
and
\begin{equation}
 \label{eq:burgers2d_06}
 \diff{ v}{t}+ \diff{ u v}{x} + \diff{  v^2 }{y}=0.
\end{equation}
%
For the inviscid case, source terms $Q_u$ and $Q_v$ are
\begin{equation}
\begin{split}
Q_u &= 2 u_0^2\, x\,[\sin\big(2(x^2+y^2+\omega t)\big)+2 \varepsilon \cos(x^2+y^2+\omega t)] +\\
&+2 u_0\, v_0\, y\,[-2 \sin^2(x^2+y^2+\omega t)-\varepsilon \sin(x^2+y^2+\omega t)+\varepsilon \cos(x^2+y^2+\omega t)+1] +\\
&+u_0\, \omega\, \cos(x^2+y^2+\omega t)
\end{split}
 \end{equation}

%Analogously, for the generation of the analytical source term $Q_v$ for the $y$-velocity, Equation~(\ref{eq:burgers2d_03}) is written as an  operator $L$:
%\begin{equation}
%  \label{eq:burgers2d_13}
%  L = \diff{ v}{t}+ \diff{ u v}{x} + \diff{  v^2 }{y}
%\end{equation}
%and then applied to Equation  (\ref{eq:manufactured02}). It yields:
\begin{equation}
\begin{split}
Q_v &= -2 v_0^2\, y\,[2 \varepsilon \sin(x^2+y^2+\omega t)+\sin\big(2(x^2+y^2+\omega t)\big)] +\\
&+2 v_0\, u_0\, x\,[-2 \sin^2(x^2+y^2+\omega t)-\varepsilon \sin(x^2+y^2+\omega t)+\varepsilon \cos(x^2+y^2+\omega t)+1] +\\
&-v_0 \omega \sin(x^2+y^2+\omega t)
 \end{split}
\end{equation}

\subsection{Steady inviscid Burgers equation}

The 2D steady inviscid Burgers  equations are:
\begin{equation}
 \label{eq:burgers2d_05}
 \diff{ u^2 }{x}+\diff{uv}{y}=0,
\end{equation}
and
\begin{equation}
 \label{eq:burgers2d_06}
 \diff{ u v}{x} + \diff{  v^2 }{y}=0. 
\end{equation}
%
For  this case, source terms $Q_u$ and $Q_v$ are  obtained by setting $\omega$ to zero in the manufactured solutions:
\begin{equation}
\begin{split}
Q_u&=2 u_0^2\, x\,[\sin\big(2(x^2+y^2)\big)+2 \varepsilon \cos(x^2+y^2)] +\\
&+  2 u_0 \,v_0\, y\,[-2 \sin^2(x^2+y^2)-\varepsilon \sin(x^2+y^2)+\varepsilon \cos(x^2+y^2)+1],
\end{split}
 \end{equation}
and
\begin{equation}
\begin{split}
Q_v=&-2 v_0^2\, y\,[2 \varepsilon \sin(x^2+y^2)+\sin\big(2(x^2+y^2)\big)] +\\
&+  2 v_0 \,u_0\, x\,[-2 \sin^2(x^2+y^2)-\varepsilon \sin(x^2+y^2)+\varepsilon \cos(x^2+y^2)+1].
 \end{split}
\end{equation}






\section{Comments}

Source terms $Q_u$ and $Q_v$ and $Q_e$ have been generated by replacing the analytical Expressions (\ref{eq:manufactured02}) into respective Equations (\ref{eq:burgers2d_01}) -- (\ref{eq:burgers2d_02}), (\ref{eq:burgers2d_03}) -- (\ref{eq:burgers2d_04}), (\ref{eq:burgers2d_05}) -- (\ref{eq:burgers2d_06}) and (\ref{eq:burgers2d_07}) -- (\ref{eq:burgers2d_08}), followed by the usage of Maple commands for collecting, sorting and factorizing the terms. Files containing $C$ codes for the source terms have also been generated. They are: \texttt{ burgers\_2d\_u\_v\_code.C, burgers\_2d\_inviscid\_u\_v\_code.C, burgers\_2d\_steady\_u\_v\_code.C,} and\\ \texttt{burgers\_2d\_steady\_inviscid\_u\_v\_code.C}.

%\newpage
An example of the automatically generated C file from the source term for the mass conservation equation is:
%\begin{small}
\begin{verbatim}
#include <math.h>

double SourceQ_rho (double x, double y, double t, double rho_0, double p_0, double u_0,
                    double v_0, double omega, double epsilon)
{
  double Q_rho;
  Q_rho = cos(x * x + y * y + omega * t) * x * (0.2e1 * epsilon + 0.4e1 *
  sin(x * x + y * y + omega * t) + 0.3e1) * u_0 * rho_0 +
  (-0.4e1 * pow(sin(x * x + y * y + omega * t), 0.2e1) -
  0.3e1 * sin(x * x + y * y + omega * t) +
  0.2e1 * cos(x * x + y * y + omega * t) * epsilon + 0.2e1) * rho_0 * v_0 * y +
  rho_0 * cos(x * x + y * y + omega * t) * omega;
  return(Q_rho);
}
\end{verbatim}
 %\end{small}

Maple's package for code generation also offers an option optimization of the code. Optimized versions of the code generated for each source code have also been created. An example of the code generated for $Q_\rho$ using such option is:
\begin{verbatim}
 #include <math.h>

double SourceQ_rho (double x, double y, double t, double rho_0, double p_0, double u_0,
                    double v_0, double omega, double epsilon)
{
  double t1;
  double t14;
  double t2;
  double t4;
  double t5;
  double t8;
  t1 = x * x;
  t2 = y * y;
  t4 = t1 + t2 + omega * t;
  t5 = cos(t4);
  t8 = sin(t4);
  t14 = t8 * t8;
  return(t5 * x * (0.3e1 + 0.2e1 * epsilon + 0.4e1 * t8) * u_0 * rho_0 +
  (0.2e1 - 0.4e1 * t14 - 0.3e1 * t8 + 0.2e1 * t5 * epsilon) * rho_0 * v_0 * y +
  rho_0 * t5 * omega);
}
\end{verbatim}



Finally, the gradients of the analytical solutions (\ref{eq:manufactured01}) have also been computed and their respective C codes are presented in  \texttt{burgers\_2d\_transient\_manuf\_solutions\_grad\_code.C}. Therefore,
\begin{equation}
\begin{array}{lll}
\nabla \rho =& \left[ \begin{array}{c}
 2  \rho_0 x \cos(x^2 + y^2 +\omega  t)  \vspace{5pt}\\
 2  \rho_0 y \cos(x^2 + y^2 + \omega  t) 
\end{array} \right],
\quad\qquad
\nabla p =& \left[ \begin{array}{c}
-2  p_0 x \sin(x^2 + y^2 + \omega  t)   \vspace{5pt}\\
 -2  p_0 y \sin(x^2 + y^2 + \omega  t) 
\end{array} \right], \vspace{10pt} \\
%
\nabla u =& \left[ \begin{array}{c}
 2  u_0 x \cos(x^2 + y^2 + \omega  t)  \vspace{5pt} \\
 2  u_0 y \cos(x^2 + y^2 + \omega  t) 
\end{array} \right]
\quad \mbox{and} \quad
\nabla v =& \left[ \begin{array}{c}
-2  v_0 x \sin(x^2 + y^2 + \omega  t) \vspace{5pt} \\
-2  v_0 y \sin(x^2 + y^2 + \omega  t)  
\end{array} \right]
\end{array}
\end{equation}
are written in C language as:
\begin{verbatim}
grad_rho_an[0] = 0.2e1 * rho_0 * cos(x * x + y * y + omega * t) * x;
grad_rho_an[1] = 0.2e1 * rho_0 * cos(x * x + y * y + omega * t) * y;
grad_p_an[0] = -0.2e1 * p_0 * sin(x * x + y * y + omega * t) * x;
grad_p_an[1] = -0.2e1 * p_0 * sin(x * x + y * y + omega * t) * y;
grad_u_an[0] = 0.2e1 * u_0 * cos(x * x + y * y + omega * t) * x;
grad_u_an[1] = 0.2e1 * u_0 * cos(x * x + y * y + omega * t) * y;
grad_v_an[0] = -0.2e1 * v_0 * sin(x * x + y * y + omega * t) * x;
grad_v_an[1] = -0.2e1 * v_0 * sin(x * x + y * y + omega * t) * y;
\end{verbatim}



%---------------------------------------------------------------------------------------------------------
\bibliographystyle{chicago} 
\bibliography{/home/kemelli/MMS_maple_workplace/heat_equation/MMS_bib}

\end{document}


\begin{equation}
\nabla \rho = \left[ \begin{array}{c}
 \dfrac{  a_{\rho x}  \pi rho_x }{L} \cos\left( \dfrac{ a_{\rho x}  \pi  x }{L}\right) \vspace{5pt}\\
 -\dfrac{  a_{\rho y}  \pi rho_y }{L} \sin\left( \dfrac{ a_{\rho y}  \pi  y }{L}\right)
\end{array} \right]\qquad
\end{equation}


\begin{equation}
\nabla p = \left[ \begin{array}{c}
- \dfrac{  a_{px}  \pi p_x }{L} \sin\left( \dfrac{ a_{px}  \pi  x }{L}\right) \vspace{5pt}\\
  \dfrac{  a_{py}  \pi p_y }{L} \cos\left( \dfrac{ a_{py}  \pi  y }{L}\right)
\end{array} \right]
\end{equation}


\begin{equation}
\nabla u = \left[ \begin{array}{c}
\dfrac{  a_{ux}  \pi u_x}{L} \cos\left( \dfrac{ a_{ux}  \pi  x }{L}\right)\vspace{5pt} \\
-  \dfrac{  a_{uy}  \pi u_y }{L} \sin\left( \dfrac{ a_{uy}  \pi  y }{L}\right)
\end{array} \right]
\end{equation}


\begin{equation}
\nabla v = \left[ \begin{array}{c}
-  \dfrac{  a_{vx}  \pi v_x }{L} \sin\left( \dfrac{ a_{vx}  \pi  x }{L}\right)\vspace{5pt} \\
 \dfrac{  a_{vy}  \pi  v_y }{L} \cos\left( \dfrac{ a_{vy}  \pi  y }{L}\right)
\end{array} \right]
\end{equation}
